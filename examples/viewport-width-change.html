<!doctype html>
<html>
<head>
<meta charset="utf-8" />
<meta name=viewport content="width=device-width" />
<style>
p {
    min-height: 300px;
    font-size: 24px;
    font-family: system-ui;
    text-align: center;
}
</style>
</head>
<body>
    <p>Rotate to landscape and back</p>
    <script>
    let currentWidth = "device-width";

    function computeUpdatedWidth() {
        const scaledWidth = Math.round(visualViewport.width * visualViewport.scale);
        if (scaledWidth <= 300)
            return 300;

        if (scaledWidth >= 700)
            return 700;

        return "device-width";
    }

    visualViewport.addEventListener("resize", () => {
        const updatedWidth = computeUpdatedWidth();
        if (currentWidth === updatedWidth)
            return;

        console.log(`Updating width: ${currentWidth} â†’ ${updatedWidth}`);
        currentWidth = updatedWidth;
        document.querySelector("meta[name=viewport]").content = `width=${updatedWidth}`;
    });
    </script>
</body>
</html>